<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æ§‹æ–‡ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼æ”¹ï¼ˆã‚¿ã‚¤ãƒ—5ãƒ»ãƒœã‚¿ãƒ³èª¿æ•´ç‰ˆï¼‰</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #f0f0f0; display: flex; justify-content: center; padding: 20px; }
        .container { background-color: #e0e0e0; width: 100%; max-width: 1000px; padding: 20px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: relative; }
        
        #item-list { margin-bottom: 20px; }
        .item-row { display: flex; align-items: flex-start; margin-bottom: 15px; position: relative; background: #e0e0e0; padding: 10px; border-radius: 4px; }
        
        .sortable-ghost { opacity: 0.4; background-color: #cfcfcf; }

        .btn-remove { width: 18px; height: 4px; background-color: #ff4d79; border: none; cursor: pointer; margin-top: 12px; margin-right: 10px; padding: 0; flex-shrink: 0; }
        
        textarea { 
            border: none; padding: 5px 8px; border-radius: 2px; 
            resize: none; overflow: hidden; font-family: inherit; font-size: 16px; 
            min-height: 1.2em; display: block; color: #000000;
        }

        .label-input { font-weight: bold; background: transparent; width: 150px; color: #000000; }
        .label-full { width: 100% !important; }

        .text-input { background-color: #f0f0f0; width: 100%; margin: 2px 0; color: #000000; }
        
        .type-custom-container { display: flex; flex-wrap: wrap; align-items: flex-start; flex-grow: 1; gap: 8px; }
        .custom-unit { display: flex; align-items: flex-start; background: #e0e0e0; padding: 2px; border-radius: 4px; position: relative; }
        
        /* ãƒãƒ„ãƒœã‚¿ãƒ³ã®é…ç½®ä¿®æ­£ï¼šä¸­å¤®æƒãˆ */
        .btn-unit-del { 
            font-size: 10px; background: #666; color: #fff; border: none; cursor: pointer; 
            border-radius: 50%; width: 14px; height: 14px; 
            display: flex; align-items: center; justify-content: center;
            margin-right: 2px; flex-shrink: 0; margin-top: 5px;
            line-height: 1; padding: 0;
        }
        
        .custom-controls { display: flex; flex-direction: column; gap: 5px; margin-left: 5px; }
        .btn-add-unit { font-size: 11px; padding: 2px 5px; cursor: pointer; border: 1px solid #999; border-radius: 3px; background: #fff; color: #333; }

        .type-right, .type-sandwich { display: flex; align-items: flex-start; flex-grow: 1; gap: 5px; }
        .type-below, .type-only { display: flex; flex-direction: column; flex-grow: 1; }

        .drag-handle { cursor: grab; margin-left: 10px; padding: 5px; color: #666; font-size: 20px; line-height: 1; user-select: none; margin-top: 2px; }

        .add-section { margin-top: 10px; border-top: 1px solid #ccc; padding-top: 10px; }
        .btn-plus { color: #00a2ff; background: none; border: none; font-size: 40px; cursor: pointer; padding: 0; line-height: 0.8; }
        .add-menu { display: none; margin-top: 5px; border: 1px solid #ccc; background: #fff; padding: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .add-menu button { display: block; width: 100%; text-align: left; font-size: 14px; margin-bottom: 5px; padding: 8px; cursor: pointer; background: #f9f9f9; border: 1px solid #e0e0e0; }

        .footer-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 30px; }
        .btn-footer { border: 2px solid #333; background: white; padding: 10px; font-weight: bold; border-radius: 8px; cursor: pointer; text-align: center; color: #000; }
        .btn-copy { grid-column: span 2; background: #333; color: white; font-size: 16px; }

        #file-input { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="item-list"></div>

    <div class="add-section">
        <button class="btn-plus" onclick="toggleMenu()">ï¼‹</button>
        <div class="add-menu" id="add-menu">
            <button onclick="addItem('right')">ã‚¿ã‚¤ãƒ—1: [é …ç›®]{ãƒ†ã‚­ã‚¹ãƒˆ}</button>
            <button onclick="addItem('below')">ã‚¿ã‚¤ãƒ—2: [é …ç›®] æ”¹è¡Œ {ãƒ†ã‚­ã‚¹ãƒˆ}</button>
            <button onclick="addItem('sandwich')">ã‚¿ã‚¤ãƒ—3: [é …ç›®]{ãƒ†ã‚­ã‚¹ãƒˆ}[é …ç›®]</button>
            <button onclick="addItem('only')">ã‚¿ã‚¤ãƒ—4: [é …ç›®]</button>
            <button onclick="addItem('custom')">ã‚¿ã‚¤ãƒ—5: è‡ªç”±é…ç½®ï¼ˆï¼‹ã§å¢—ã‚„ã™ï¼‰</button>
        </div>
    </div>

    <div class="footer-btns">
        <button class="btn-footer" onclick="exportToFile()">ğŸ’¾ ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜</button>
        <button class="btn-footer" onclick="triggerFileInput()">ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼</button>
        <button class="btn-footer" onclick="textclearAll()">ğŸ—‘ï¸ ãƒ†ã‚­ã‚¹ãƒˆå…¨æ¶ˆå»</button>
        <button class="btn-footer" onclick="clearAll()">âŒ é …ç›®ã‚’å…¨å‰Šé™¤</button>
        <button class="btn-footer btn-copy" onclick="copyAll()">ğŸ“‹ å…¨ã‚³ãƒ”ãƒ¼</button>
    </div>

    <input type="file" id="file-input" accept=".json" onchange="importFromFile(this)">
</div>

<script>
    const itemList = document.getElementById('item-list');
    const addMenu = document.getElementById('add-menu');

    new Sortable(itemList, { handle: '.drag-handle', animation: 150, ghostClass: 'sortable-ghost' });

    function toggleMenu() { addMenu.style.display = addMenu.style.display === 'block' ? 'none' : 'block'; }

    function autoResize(el) {
        if (!el) return;
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
    }

    function createUnit(unitType, val = "") {
        const div = document.createElement('div');
        div.className = 'custom-unit';
        div.dataset.unitType = unitType;
        
        const isLabel = unitType === 'label';
        // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’æ¶ˆã—ã€ãƒ©ãƒ™ãƒ«ï¼ˆé …ç›®ï¼‰ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ã€Œé …ç›®ã€ã‚’å…¥ã‚Œã‚‹
        let finalVal = val;
        if (isLabel && !val) finalVal = "é …ç›®";

        const cls = isLabel ? "label-input" : "text-input";
        
        div.innerHTML = `
            <button class="btn-unit-del" onclick="this.parentElement.remove()">Ã—</button>
            <textarea class="${cls}" oninput="autoResize(this)" rows="1">${finalVal}</textarea>
        `;
        return div;
    }

    function addItem(type, data = null) {
        const div = document.createElement('div');
        div.className = 'item-row';
        div.dataset.type = type;

        let contentHTML = `<button class="btn-remove" onclick="this.parentElement.remove()"></button>`;

        if (type === 'custom') {
            div.innerHTML = contentHTML + `
                <div class="type-custom-container" id="custom-area"></div>
                <div class="custom-controls">
                    <button class="btn-add-unit" onclick="addUnitToRow(this, 'label')">ï¼‹æ </button>
                    <button class="btn-add-unit" onclick="addUnitToRow(this, 'text')">ï¼‹æ–‡</button>
                </div>
                <div class="drag-handle">ï¼</div>`;
            
            const area = div.querySelector('#custom-area');
            if (data && data.units) {
                data.units.forEach(u => area.appendChild(createUnit(u.unitType, u.val)));
            } else {
                area.appendChild(createUnit('label'));
                area.appendChild(createUnit('text'));
            }
        } else {
            const labelVal = data ? data.label : "é …ç›®";
            const labelPostVal = data ? data.labelPost : "é …ç›®";
            const textVal = data ? data.text : "";

            if (type === 'right') {
                contentHTML += `
                    <div class="type-right">
                        <textarea class="label-input" oninput="autoResize(this)" rows="1">${labelVal}</textarea>
                        <textarea class="text-input" rows="1" oninput="autoResize(this)">${textVal}</textarea>
                    </div>`;
            } else if (type === 'below') {
                contentHTML += `
                    <div class="type-below">
                        <div><textarea class="label-input" oninput="autoResize(this)" rows="1">${labelVal}</textarea></div>
                        <textarea class="text-input" rows="1" oninput="autoResize(this)">${textVal}</textarea>
                    </div>`;
            } else if (type === 'sandwich') {
                contentHTML += `
                    <div class="type-sandwich">
                        <textarea class="label-input label-pre" oninput="autoResize(this)" rows="1">${labelVal}</textarea>
                        <textarea class="text-input" rows="1" oninput="autoResize(this)">${textVal}</textarea>
                        <textarea class="label-input label-post" oninput="autoResize(this)" rows="1">${labelPostVal}</textarea>
                    </div>`;
            } else if (type === 'only') {
                contentHTML += `
                    <div class="type-only">
                        <div><textarea class="label-input label-full" oninput="autoResize(this)" rows="1">${labelVal}</textarea></div>
                    </div>`;
            }
            contentHTML += `<div class="drag-handle">ï¼</div>`;
            div.innerHTML = contentHTML;
        }

        itemList.appendChild(div);
        div.querySelectorAll('textarea').forEach(el => autoResize(el));
        addMenu.style.display = 'none';
    }

    function addUnitToRow(btn, unitType) {
        const area = btn.parentElement.parentElement.querySelector('.type-custom-container');
        const unit = createUnit(unitType);
        area.appendChild(unit);
        autoResize(unit.querySelector('textarea'));
    }

    function exportToFile() {
        const rows = document.querySelectorAll('.item-row');
        const dataToSave = [];
        rows.forEach(row => {
            const type = row.dataset.type;
            if (type === 'custom') {
                const units = [];
                row.querySelectorAll('.custom-unit').forEach(u => {
                    units.push({ unitType: u.dataset.unitType, val: u.querySelector('textarea').value });
                });
                dataToSave.push({ type, units });
            } else {
                const textEl = row.querySelector('.text-input');
                const text = textEl ? textEl.value : "";
                let label = "", labelPost = "";
                if (type === 'sandwich') {
                    label = row.querySelector('.label-pre').value;
                    labelPost = row.querySelector('.label-post').value;
                } else {
                    const labelInput = row.querySelector('.label-input');
                    label = labelInput ? labelInput.value : "";
                }
                dataToSave.push({ type, label, labelPost, text });
            }
        });

        const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'syntax_data.json'; a.click();
        URL.revokeObjectURL(url);
    }

    function triggerFileInput() { document.getElementById('file-input').click(); }

    function importFromFile(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const dataArray = JSON.parse(e.target.result);
                if (confirm("ç¾åœ¨ã®å†…å®¹ã‚’æ¶ˆå»ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿ")) {
                    itemList.innerHTML = "";
                    dataArray.forEach(item => addItem(item.type, item));
                }
            } catch (err) { alert("å½¢å¼ã‚¨ãƒ©ãƒ¼"); }
            input.value = "";
        };
        reader.readAsText(file);
    }

    function copyAll() {
        const rows = document.querySelectorAll('.item-row');
        let fullText = "";
        rows.forEach(row => {
            const type = row.dataset.type;
            if (type === 'custom') {
                row.querySelectorAll('.custom-unit textarea').forEach(ta => fullText += ta.value);
                fullText += "\n";
            } else {
                const textEl = row.querySelector('.text-input');
                const text = textEl ? textEl.value : "";
                if (type === 'right') fullText += `${row.querySelector('.label-input').value}${text}\n`;
                else if (type === 'below') fullText += `${row.querySelector('.label-input').value}\n${text}\n`;
                else if (type === 'sandwich') fullText += `${row.querySelector('.label-pre').value}${text}${row.querySelector('.label-post').value}\n`;
                else if (type === 'only') fullText += `${row.querySelector('.label-input').value}\n`;
            }
        });
        navigator.clipboard.writeText(fullText.trim()).then(() => alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"));
    }

    function textclearAll() {
        if (confirm("å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã‚’ã™ã¹ã¦æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿ")) {
            document.querySelectorAll('.text-input').forEach(input => {
                input.value = "";
                autoResize(input);
            });
        }
    }

    function clearAll() { if (confirm("ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) itemList.innerHTML = ""; }

    addItem('right');
</script>

</body>
</html>
